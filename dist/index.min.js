!function(){var a,h,t;function v(t,e){var r,i={}.hasOwnProperty;for(r in e)i.call(e,r)&&(t[r]=e[r]);return t}function b(t,e){for(var r=-1,i=e.length>>>0;++r<i;)if(t===e[r])return 1}a="http://www.w3.org/2000/svg",h=["#ff0","#0ff","#f0f","#fff"],(t=function(i){var n,r,p,t,s,e,o,M,g=this,w=(i=null==i?{}:i).host||i.root;return v(this,{opt:i,evtHandler:{},tgt:[],host:w="string"==typeof w?document.querySelector(w):i.host,root:i.root?n="string"==typeof i.root?document.querySelector(i.root):i.root:void 0,filter:r=i.filter||null,mousedown:i.mousedown||null,dim:p={s:{x:1,y:1},t:{x:0,y:0},r:0,x:0,y:0,w:0,h:0,mo:null}}),this.host.classList.add("ldr-host"),this.host!==this.root&&this.host.classList.add("ldr-host-standalone"),this.n={s:t=[0,1,2,3,4,5,6,7,8].map(function(t,e){var r=document.createElementNS(a,"rect");return r.classList.add("ldr-ctrl","s"),r.setAttribute("data-nx",e%3),r.setAttribute("data-ny",Math.floor(e/3)),r}),r:s=[0,1,2,3].map(function(t,e){var r=document.createElementNS(a,"rect");return r.classList.add("ldr-ctrl","r"),r.setAttribute("data-nx",e%2*2),r.setAttribute("data-ny",2*Math.floor(e/2)),i.visibleCtrlR&&r.setAttribute("fill",h[e]),i.visibleCtrlR&&r.style.opacity(.5),r}),g:e=document.createElementNS(a,"g")},this.n.b=o=document.createElementNS(a,"path"),o.classList.add("ldr-ctrl","bbox"),e.appendChild(o),s.map(function(t){return e.appendChild(t)}),t.map(function(t){return e.appendChild(t)}),w.appendChild(e),M={up:function(t){return document.removeEventListener("mouseup",M.up),document.removeEventListener("mousemove",M.move)},downRoot:function(t){var e;if(!(0<t.button))return!(e=t.target)||!e.classList||e.classList.contains("ldr-ctrl")||e===n||r&&!r(e)?g.detach():(document.addEventListener("mouseup",M.up),document.addEventListener("mousemove",M.move),M.ix=t.clientX,M.iy=t.clientY,M.nx=1,M.ny=1,M.n=s[1],g.mousedown?g.attach(g.mousedown(t)):g.tgt.length&&b(e,g.tgt)?void 0:g.attach(e,t.shiftKey))},downHost:function(t){var e,r,i;if((e=t.target)&&t.target.classList&&!(0<t.button))return e.classList.contains("ldr-ctrl")?(document.addEventListener("mouseup",M.up),document.addEventListener("mousemove",M.move),r=(i=["data-nx","data-ny"].map(function(t){return+e.getAttribute(t)}))[0],i=i[1],v(M,{ix:t.clientX,iy:t.clientY,nx:r,ny:i,n:e})):n===w?M.downRoot(t):g.detach(),t.stopPropagation()},move:function(t){var e,r,i,n,s,o,a,h,d,y,u=[t.clientX,t.clientY,M.nx,M.ny],l=u[0],x=u[1],c=u[2],m=u[3],f=w.getBoundingClientRect();return 1===c&&1===m?(e=(u=[l-M.ix,x-M.iy])[0],r=u[1],t.shiftKey&&(e=(u=Math.abs(e)>Math.abs(r)?[e,0]:[0,r])[0],r=u[1]),u=[p.t.x+e,p.t.y+r],p.t.x=u[0],p.t.y=u[1],M.ix=l,M.iy=x,g.fire("resize",{dim:g.dim,targets:g.tgt}),g.render()):(d=(u=g.pts()).pt,e=u.pc,r=u.pv,u.mc,M.n.classList.contains("r")?(n=[(i=[c*r[0].x/2+m*r[1].x/2+d[0].x,c*r[0].y/2+m*r[1].y/2+d[0].y])[0]-e.x,i[1]-e.y],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.acos(n[0]/s),n[1]<0&&(o=2*Math.PI-o),n=[(a=[l-f.x,x-f.y])[0]-e.x,a[1]-e.y],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]),h=Math.acos(n[0]/s),n[1]<0&&(h=2*Math.PI-h),p.r+=h-o,t.shiftKey&&(p.r=Math.floor(p.r/(Math.PI/8))*(Math.PI/8)),g.fire("resize",{dim:g.dim,targets:g.tgt}),g.render()):M.n.classList.contains("s")?(h=[(2-c)*r[0].x/2+(2-m)*r[1].x/2+d[0].x,(2-c)*r[0].y/2+(2-m)*r[1].y/2+d[0].y],i=[c*r[0].x/2+m*r[1].x/2+d[0].x,c*r[0].y/2+m*r[1].y/2+d[0].y],n=[h[0]-e.x,h[1]-e.y],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.acos(n[0]/s),n[1]<0&&(o=2*Math.PI-o),d=h,a=[l-f.x,x-f.y],t.shiftKey&&(n=[Math.cos(o+Math.PI),Math.sin(o+Math.PI)],y=[a[0]-e.x,a[1]-e.y],y=Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2)),a=[e.x+n[0]*y,e.y+n[1]*y]),y=[(d[0]+a[0])/2,(d[1]+a[1])/2],n=[a[0]-y[0],a[1]-y[1]],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.acos(n[0]/s),n[1]<0&&(o=2*Math.PI-o),o-=p.r,i=[y[0]+s*Math.cos(o),y[1]+s*Math.sin(o)],n=[d[0]-y[0],d[1]-y[1]],s=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.acos(n[0]/s),n[1]<0&&(o=2*Math.PI-o),o-=p.r,h=[y[0]+s*Math.cos(o),y[1]+s*Math.sin(o)],0===c&&(u=[(h[0]-i[0])/p.w,p.t.x+(y[0]-e.x)],p.s.x=u[0],p.t.x=u[1]),0===m&&(u=[(h[1]-i[1])/p.h,p.t.y+(y[1]-e.y)],p.s.y=u[0],p.t.y=u[1]),2===c&&(u=[(i[0]-h[0])/p.w,p.t.x+(y[0]-e.x)],p.s.x=u[0],p.t.x=u[1]),2===m&&(u=[(i[1]-h[1])/p.h,p.t.y+(y[1]-e.y)],p.s.y=u[0],p.t.y=u[1]),g.fire("resize",{dim:g.dim,targets:g.tgt}),g.render()):void 0)}},w.addEventListener("mousedown",M.downHost),n&&w!==n&&n.addEventListener("mousedown",M.downRoot),this}).prototype=v(Object.create(Object.prototype),{on:function(t,e){var r;return((r=this.evtHandler)[t]||(r[t]=[])).push(e)},fire:function(t){for(var e,r,i,n,s=[],o=[],a=1,h=arguments.length;a<h;++a)o.push(arguments[a]);for(e=o,a=0,i=(r=this.evtHandler[t]||[]).length;a<i;++a)n=r[a],s.push(n.apply(this,e));return s},set:function(){},get:function(){return this.dim},boxOffset:function(){var t,e,r,i,n;return this.host===this.root?{dx:0,dy:0}:(t=this.host.getBoundingClientRect(),e=this.root.getBoundingClientRect(),i=(r=(n=this.root.getAttribute("viewBox"))?n.split(" "):[0,0,0,0])[0],n=r[1],r[2],r[3],{dx:e.x-t.x-i,dy:e.y-t.y-n})},attach:function(t,e){var r,i,n,s,o,a,h,d,y,u,l,x,c,m,f,p,M,g=this;if(null==e&&(e=!1),t=Array.isArray(t)?t:[t],this.tgt=e?this.tgt.concat(t.filter(function(t){return!b(t,g.tgt)})):t,!this.tgt.length)return this.detach();if(this.n.g.style.display="block",i=(r=[this.host,this.root].map(function(t){return t.getBoundingClientRect()}))[0],n=r[1],s=function(t){var e;return t&&"svg"!==t.nodeName.toLowerCase()?(e=(e=t.transform.baseVal.consolidate())?e.matrix:g.host.createSVGMatrix(),s(t.parentNode).multiply(e)):g.host.createSVGMatrix()},o={s:{x:1,y:1},r:0,t:{x:0,y:0}},a=(r=(M=this.root.getAttribute("viewBox"))?M.split(" ").map(function(t){return+t}):[0,0,0,0])[0],h=r[1],r[2],r[3],1<this.tgt.length)d={x1:null,x2:null,y1:null,y2:null},this.tgt.map(function(t){var e,r=t.getBoundingClientRect();return(null===d.x1||d.x1>r.x)&&(d.x1=r.x),(null===d.x2||d.x2<r.x+r.width)&&(d.x2=r.x+r.width),(null===d.y1||d.y1>r.y)&&(d.y1=r.y),(null===d.y2||d.y2<r.y+r.height)&&(d.y2=r.y+r.height),e=(t.transform.baseVal.consolidate()||{}).matrix||{a:1,b:0,c:0,d:1,e:0,f:0},t._mi=((r=g.host.createSVGMatrix()).a=e.a,r.b=e.b,r.c=e.c,r.d=e.d,r.e=e.e,r.f=e.f,r),t._mo=s(t.parentNode)}),this.dim.box=y={x:d.x1-n.x+a,y:d.y1-n.y+h,w:d.x2-d.x1,h:d.y2-d.y1},u=(r=[y.x+y.w/2,y.y+y.h/2])[0],l=r[1];else{for(this.tgt[0]._mo=e=s(this.tgt[0].parentNode),(t=this.tgt[0].cloneNode(!0)).transform.baseVal.initialize(this.host.createSVGTransformFromMatrix(e)),this.host.appendChild(t),d=t.getBoundingClientRect(),t.parentNode.removeChild(t),this.dim.box=y={x:d.x-i.x,y:d.y-i.y,w:d.width,h:d.height},u=(r=[y.x+y.w/2,y.y+y.h/2])[0],l=r[1],x=this.tgt[0].transform.baseVal,c=this.host.createSVGMatrix(),m=0,f=x.numberOfItems;m<f;++m)p=m,c=c.multiply(x.getItem(p).matrix);M=this.tgt[0]._mo.multiply(c.multiply(this.tgt[0]._mo.inverse())),(r=o.s).x=Math.sqrt(Math.pow(M.a,2)+Math.pow(M.b,2)),r.y=Math.sqrt(Math.pow(M.c,2)+Math.pow(M.d,2)),o.r=Math.acos(M.a/o.s.x),M.b<0&&(o.r=2*Math.PI-o.r),1e-5<Math.pow(M.c-o.s.y*-Math.sin(o.r),2)+Math.pow(M.d-o.s.y*Math.cos(o.r),2)?(M=this.tgt[0]._mo.multiply(x.getItem(0).matrix.multiply(this.tgt[0]._mo.inverse())),(r=o.s).x=Math.sqrt(Math.pow(M.a,2)+Math.pow(M.b,2)),r.y=Math.sqrt(Math.pow(M.c,2)+Math.pow(M.d,2)),o.r=Math.acos(M.a/o.s.x),M.b<0&&(o.r=2*Math.PI-o.r),1e-5<Math.pow(M.c-o.s.y*-Math.sin(o.r),2)+Math.pow(M.d-o.s.y*Math.cos(o.r),2)?(d=this.tgt[0].getBoundingClientRect(),this.dim.box=y={x:d.x-n.x+a,y:d.y-n.y+h,w:d.width,h:d.height},u=(r=[y.x+y.w/2,y.y+y.h/2])[0],l=r[1],(r=o.s).x=1,r.y=1,(r=o.t).x=0,r.y=0,o.r=0):(c=x.getItem(0).matrix.inverse().multiply(c),t.transform.baseVal.initialize(this.host.createSVGTransformFromMatrix(e.multiply(c))),this.host.appendChild(t),d=t.getBoundingClientRect(),t.parentNode.removeChild(t),this.dim.box=y={x:d.x-i.x,y:d.y-i.y,w:d.width,h:d.height},u=(r=[y.x+y.w/2,y.y+y.h/2])[0],l=r[1],v(o.t,{x:M.e+o.s.x*u*Math.cos(o.r)-o.s.y*l*Math.sin(o.r)-u,y:M.f+o.s.x*u*Math.sin(o.r)+o.s.y*l*Math.cos(o.r)-l}))):(v(o.t,{x:M.e+o.s.x*u*Math.cos(o.r)-o.s.y*l*Math.sin(o.r)-u,y:M.f+o.s.x*u*Math.sin(o.r)+o.s.y*l*Math.cos(o.r)-l}),c=this.host.createSVGMatrix()),this.tgt[0]._mi=c}return v(this.dim,o),v(this.dim,y),this.render()},detach:function(){return this.tgt.map(function(t){return t._mi=null,t._mo=null,t}),this.tgt=[],this.n.g.style.display="none"},pts:function(){var e,r,t=this.dim,i=[t.x+t.w/2,t.y+t.h/2],n=i[0],s=i[1],o=t.s.x*Math.cos(t.r),a=t.s.x*Math.sin(t.r),h=-t.s.y*Math.sin(t.r),d=t.s.y*Math.cos(t.r),y=-t.s.x*n*Math.cos(t.r)+t.s.y*s*Math.sin(t.r)+n+t.t.x,i=-t.s.x*n*Math.sin(t.r)-t.s.y*s*Math.cos(t.r)+s+t.t.y,u=this.host.createSVGMatrix();return u.a=o,u.b=a,u.c=h,u.d=d,u.e=y,u.f=i,e=this.host.createSVGPoint(),n=[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}].map(function(t){return v(e,t).matrixTransform(u)}),e.x=t.x+.5*t.w,e.y=t.y+.5*t.h,s=e.matrixTransform(u),t=[{x:n[1].x-n[0].x,y:n[1].y-n[0].y},{x:n[3].x-n[0].x,y:n[3].y-n[0].y}],r=this.boxOffset(),n.map(function(t){return t.x=t.x+r.dx,t.y=t.y+r.dy,t}),s.x=s.x+r.dx,s.y=s.y+r.dy,{a:o,b:a,c:h,d:d,e:y,f:i,pt:n,pc:s,pv:t}},render:function(){this.dim;var t,e,r,i,n,s,o,a,h,d,y,u,l,x=[this.n.g,this.n.b,this.n.s,this.n.r],c=(x[0],x[1]),m=x[2],f=x[3],p=(x=this.pts()).a,M=x.b,g=x.c,w=x.d,v=x.e,b=x.f,L=x.pt,C=x.pc,S=x.pv;for(c.setAttribute("d","M"+L[0].x+" "+L[0].y+"\nL"+L[1].x+" "+L[1].y+"\nL"+L[2].x+" "+L[2].y+"\nL"+L[3].x+" "+L[3].y+"\nZ"),t=(x=[8,4,2])[0],e=x[1],r=x[2],i=0;i<=2;++i)for(n=i,s=0;s<=2;++s)(1!==(o=s)&&1!==n||1===o&&1===n)&&[["width",t],["height",t],["x",o*S[0].x/2+n*S[1].x/2+L[0].x-e],["y",o*S[0].y/2+n*S[1].y/2+L[0].y-e]].map(_);for(i=0;i<=1;++i)for(n=i,s=0;s<=1;++s)a=(o=s)*S[0].x+n*S[1].x+L[0].x,h=o*S[0].y+n*S[1].y+L[0].y,d=a-C.x,y=h-C.y,[["x",a+=(u=Math.sqrt(Math.pow(d,2)+Math.pow(y,2)))?d*t/u-e*r:0],["y",h+=u?y*t/u-e*r:0],["width",t*r],["height",t*r]].map(A);return(x=this.host.createSVGMatrix()).a=p,x.b=M,x.c=g,x.d=w,x.e=v,x.f=b,l=x,this.tgt.map(function(e,t){var r=e._mo.inverse().multiply(l.multiply(e._mo)),i=r.a,n=r.b,s=r.c,o=r.d,a=r.e,r=r.f;return e._lasttransform||(e._lasttransform=e.getAttribute("transform")),e.setAttribute("transform","matrix("+i+" "+n+" "+s+" "+o+" "+a+" "+r+")"+(e._mi?" matrix("+["a","b","c","d","e","f"].map(function(t){return e._mi[t]}).join(" ")+")":""))});function _(t){return m[3*n+o].setAttribute(t[0],t[1])}function A(t){return f[2*n+o].setAttribute(t[0],t[1])}}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.ldresize=t)}.call(this);
